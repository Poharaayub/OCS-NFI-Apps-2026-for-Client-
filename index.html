<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>OCS NFI APPS 2026 Client</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <style>
        :root {
            --m3-bg: #1A1C19; 
            --m3-surface: #222521;
            --m3-surface-container-high: #2A2E29;
            --m3-primary: #B5CCBA; 
            --m3-primary-container: #2D352E; 
            --m3-on-primary-container: #D1E8D5;
            --m3-secondary-container: #3E4A3F;
            --m3-on-secondary-container: #DDE6DB;
            --m3-on-surface: #E2E3DE;
            --m3-on-surface-variant: #C1C9BE;
            --nav-height: 72px;
            --nav-bottom-margin: 20px;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            margin: 0; padding: 0;
        }

        body { 
            background-color: var(--m3-bg); 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            height: 100dvh; 
            width: 100vw;
            overflow: hidden; /* Tetap hidden di body untuk mencegah double scrollbar browser */
            color: var(--m3-on-surface);
            line-height: 1.5;
        }

        header {
            padding: calc(env(safe-area-inset-top) + 16px) 24px 16px;
            background: rgba(26, 28, 25, 0.8);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            position: fixed; top: 0; left: 0; right: 0; z-index: 40;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        header.hidden-header {
            transform: translateY(-100%);
            opacity: 0;
            pointer-events: none;
        }

        /* Container Halaman Utama */
        .page-container {
            height: 100dvh;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .page { 
            display: none; 
            height: 100%;
            width: 100%;
            opacity: 0;
            overflow-y: auto; /* Aktifkan scroll di dalam page */
            -webkit-overflow-scrolling: touch;
            padding: calc(85px + env(safe-area-inset-top)) 16px calc(var(--nav-height) + var(--nav-bottom-margin) + 40px + env(safe-area-inset-bottom));
        }
        
        /* Halaman Periodik (Full Webview) */
        .page.full-page {
            padding: 0 !important;
            height: 100dvh;
            width: 100vw;
            overflow: hidden; /* Periodik tidak boleh scroll internal karena ada iframe */
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10;
        }

        .page.active { 
            display: block; 
            opacity: 1; 
            animation: fade-in 0.3s ease-out forwards; 
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Navigasi tetap melayang */
        nav {
            position: fixed; 
            bottom: calc(var(--nav-bottom-margin) + env(safe-area-inset-bottom)); 
            left: 16px; 
            right: 16px;
            height: var(--nav-height); 
            background: rgba(34, 37, 33, 0.85); 
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex; 
            justify-content: space-around; 
            align-items: center;
            z-index: 50; 
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 12px 32px rgba(0,0,0,0.5);
            padding: 0 8px;
        }
        
        .n-btn { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            flex: 1; 
            height: 100%;
            transition: all 0.2s ease; 
            cursor: pointer;
        }
        
        .n-btn:active { transform: scale(0.9); }

        .icon-wrapper {
            width: 54px; 
            height: 30px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-radius: 16px; 
            transition: all 0.3s cubic-bezier(0.2, 0, 0, 1); 
            color: var(--m3-on-surface-variant);
            margin-bottom: 2px;
        }
        
        .n-btn.active .icon-wrapper { 
            background-color: var(--m3-primary-container); 
            color: var(--m3-primary); 
        }

        .n-btn .material-symbols-rounded { 
            font-variation-settings: 'FILL' 0, 'wght' 400; 
            font-size: 24px; 
        }
        
        .n-btn.active .material-symbols-rounded { 
            font-variation-settings: 'FILL' 1, 'wght' 400; 
        }
        
        .n-txt { 
            font-size: 10px; 
            font-weight: 600; 
            color: var(--m3-on-surface-variant); 
            letter-spacing: 0.2px;
        }
        
        .n-btn.active .n-txt { 
            color: var(--m3-on-surface); 
        }

        .card { 
            background: var(--m3-surface-container-high); 
            padding: 14px 18px; 
            margin-bottom: 12px; 
            border-radius: 20px; 
            display: flex; 
            align-items: center; 
            width: 100%; 
            border: 1px solid rgba(255,255,255,0.03);
            color: inherit;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .card:active { transform: scale(0.96); background: var(--m3-secondary-container); }
        
        .c-icon { 
            width: 44px; height: 44px; border-radius: 12px; 
            background: var(--m3-secondary-container); 
            color: var(--m3-primary); 
            display: flex; align-items: center; justify-content: center; 
            margin-right: 14px; 
            flex-shrink: 0;
        }

        #fab-periodik { 
            width: 56px; height: 56px; border-radius: 18px; 
            display: flex; align-items: center; justify-content: center; 
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            position: fixed; 
            bottom: calc(var(--nav-height) + var(--nav-bottom-margin) + 24px + env(safe-area-inset-bottom)); 
            right: 20px; 
            z-index: 60;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        #scrim { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; 
            display: none; opacity: 0; transition: opacity 0.3s ease; 
            backdrop-filter: blur(4px);
        }
        
        #sheet { 
            position: fixed; 
            bottom: 0; left: 0; right: 0; 
            background: var(--m3-bg); 
            z-index: 1001; 
            height: 85vh;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1);
            display: flex; flex-direction: column;
            border-radius: 28px 28px 0 0;
            box-shadow: 0 -8px 32px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .sheet-visible #sheet { transform: translateY(0); }
        .sheet-visible #scrim { display: block; opacity: 1; }

        .sheet-handle {
            width: 36px; height: 4px; background: rgba(255,255,255,0.15); 
            border-radius: 2px; margin: 12px auto 8px;
        }

        .m3-loader { width: 40px; height: 40px; border: 3px solid rgba(181, 204, 186, 0.1); border-top-color: var(--m3-primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body id="app-body">

    <header id="main-header">
        <h1 id="h-title" class="font-extrabold text-2xl tracking-tight text-[#B5CCBA]">Daily Activity</h1>
    </header>

    <div id="fab-periodik" class="bg-[#B5CCBA] text-[#1A1C19] scale-0 opacity-0 pointer-events-none" onclick="window.open('https://drive.google.com/drive/folders/1Y-sgaereUh9w-HSFwXsGm4GYHN9dLn9Y', '_blank')">
        <span class="material-symbols-rounded !text-2xl">folder_open</span>
    </div>

    <div id="scrim" onclick="closeSheet()"></div>
    
    <div id="sheet">
        <div class="sheet-handle"></div>
        <div class="sheet-header flex items-center px-4 pb-3 border-b border-white/5">
            <button onclick="closeSheet()" class="w-10 h-10 flex items-center justify-center text-white/70">
                <span class="material-symbols-rounded">close</span>
            </button>
            <h2 id="s-title" class="text-base font-bold flex-1 text-center truncate px-2 text-white/90">Pratinjau</h2>
            <button id="btn-external" class="w-10 h-10 rounded-xl bg-[#2D352E] text-[#B5CCBA] flex items-center justify-center hidden">
                <span class="material-symbols-rounded !text-lg">open_in_new</span>
            </button>
            <div id="placeholder-btn" class="w-10"></div>
        </div>
        
        <div id="sheet-content-area" class="flex-1 overflow-hidden relative bg-[#1A1C19]">
            <div id="loading-ui" class="absolute inset-0 flex items-center justify-center bg-[#1A1C19] z-10 hidden">
                <div class="m3-loader"></div>
            </div>
            <div id="sheet-content" class="h-full w-full overflow-y-auto"></div>
        </div>
    </div>

    <div class="page-container">
        <main class="h-full w-full">
            <div id="p1" class="page active"></div>
            <div id="p2" class="page full-page">
                <iframe id="iframe-periodik" class="w-full h-full border-none bg-black" src="" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
            </div>
            <div id="p3" class="page"></div>
            <div id="p4" class="page"></div>
            <div id="p5" class="page"></div>
        </main>
    </div>

    <nav id="floating-nav">
        <div class="n-btn active" onclick="go('p1', 'Daily Activity', this)">
            <div class="icon-wrapper"><span class="material-symbols-rounded">dashboard</span></div>
            <span class="n-txt">Daily</span>
        </div>
        <div class="n-btn" onclick="go('p2', 'Periodik', this)">
            <div class="icon-wrapper"><span class="material-symbols-rounded">event_repeat</span></div>
            <span class="n-txt">Periodik</span>
        </div>
        <div class="n-btn" onclick="go('p3', 'Request', this)">
            <div class="icon-wrapper"><span class="material-symbols-rounded">add_circle</span></div>
            <span class="n-txt">Request</span>
        </div>
        <div class="n-btn" onclick="go('p4', 'Laporan', this)">
            <div class="icon-wrapper"><span class="material-symbols-rounded">assignment</span></div>
            <span class="n-txt">Laporan</span>
        </div>
        <div class="n-btn" onclick="go('p5', 'Member', this)">
            <div class="icon-wrapper"><span class="material-symbols-rounded">group</span></div>
            <span class="n-txt">Member</span>
        </div>
    </nav>

    <script>
        const members = [
            { n: "Junaidi", d: "OCS Area Manager", p: "6285886607991" },
            { n: "Pohara Ayub", d: "Team Leader", p: "6289637126728" },
            { n: "Sadulloh", d: "Team Leader", p: "6285281587927" },
            { n: "Sulaiman", d: "CSO Head Office Jakarta", p: "6285716230391" },
            { n: "Saiful Bahri", d: "CSO Office Lantai 1", p: "6281389327308" },
            { n: "Siti Maemunah", d: "CSO Office Lantai 2", p: "6285771090915" },
            { n: "Wahidin", d: "Gardener", p: "6283819602330" },
            { n: "Edi Ahmad Jubaedi", d: "CSO Produksi", p: "6285883524329" },
            { n: "Ade Surahman", d: "CSO Produksi", p: "6281947172711" },
            { n: "Muhammad Toni", d: "CSO Produksi", p: "6281286448626" },
            { n: "M. Rifai", d: "CSO Produksi", p: "6285810611074" },
            { n: "Amrullah", d: "CSO Warehouse 2 & 1", p: "6283879624040" },
            { n: "Nabrih", d: "WH Tepung Specialist", p: "6281295412005" }
        ];

        const menuData = {
            p1: [
                {l:"HO Jakarta", i:"apartment", url:"https://docs.google.com/spreadsheets/d/1xleDib2bas3Z17D4rsxXufCL7U-x_fLXRPRHuys4jQ0/edit"},
                {l:"Office Lantai 2", i:"layers", url:"https://docs.google.com/spreadsheets/d/1tyMsJDVou1WAPlNJ91pwmJRSwbEp11WTkxKHh06t_ok/edit"},
                {l:"Office Lantai 1", i:"floor", url:"https://docs.google.com/spreadsheets/d/14PpB7OEDIW_si7OgyKO2LAjJGHeXXAzC8JDvjoD3yC8/edit"},
                {l:"Gardener Area", i:"park", url:"https://docs.google.com/spreadsheets/d/1Fb4O-uwNcqmfDU9XfxGdGXgcGGUgYXGTl0fctk8WFLs/edit"},
                {l:"Produksi Area", i:"factory", s:"prod"},
                {l:"Warehouse 2 & 1", i:"inventory_2", url:"https://docs.google.com/spreadsheets/d/1xhyGL_HEfzX2YP8ehgrstr2DfjAcuMR9txdH7rcohbI/edit"},
                {l:"Warehouse 1", i:"warehouse", url:"https://docs.google.com/spreadsheets/d/1WeXStuNQlU53G7NtmMIIZcUdyQnQD7OTsJRgf6kCrPo/edit"}
            ],
            p3: [
                {l:"Request ke Team Leader", i:"hail", s:"req_tl"}, 
                {l:"Request ke Cleaner", i:"cleaning_services", s:"req_cso"}
            ],
            p4: [
                {l:"Schedule Member", i:"calendar_today", url:"https://docs.google.com/spreadsheets/d/1TUSJ4jp6Ag7bFnUk54YpES1SKo8m_FBekuG-fShZaE8/edit"},
                {l:"Laporan Pencucian Box", i:"inventory", url:"https://docs.google.com/spreadsheets/d/1vf2pzwlvdsm17cyo1Zrc6DBUL4EeQOng5uJjU12aYvg/edit"},
                {l:"Laporan Pencucian Pallet", i:"view_agenda", url:"https://docs.google.com/spreadsheets/d/13dPCq4lEhV4PRA4z2RLQEmPbOIBK9emuclkxk-Dh7iU/edit"},
                {l:"Laporan Pembersihan Pallet Warehouse Tepung", i:"cleaning_bucket", url:"https://docs.google.com/spreadsheets/d/1C9Zrywvi_ggnHnKHB9fxUU9f-DCWaGNFJflKqbHVEnI/edit"},
                {l:"Feedback & Complaint", i:"forum", url:"https://wa.me/6289637126728", ext:true},
                {l:"Big Cleaning", i:"folder_shared", url:"https://drive.google.com/drive/folders/1c1mQZI8IuOqy1HnGMozhmQqVbvW--vpz", ext:true}
            ]
        };

        let sheetIsOpen = false;

        function go(id, title, el) {
            const header = document.getElementById('main-header');
            
            document.querySelectorAll('.n-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const targetPage = document.getElementById(id);
            targetPage.classList.add('active');
            
            // Penting: Reset scroll setiap ganti halaman
            targetPage.scrollTop = 0;
            
            const fab = document.getElementById('fab-periodik');
            const iframe = document.getElementById('iframe-periodik');

            if(id === 'p2') {
                header.classList.add('hidden-header');
                fab.classList.replace('scale-0', 'scale-100');
                fab.classList.replace('opacity-0', 'opacity-100');
                fab.classList.remove('pointer-events-none');
                
                if(!iframe.src || iframe.src === window.location.href) {
                    iframe.src = "https://poharaayub.github.io/OCS-NFI-Job-Desk-Apps-Client-/";
                }
            } else {
                header.classList.remove('hidden-header');
                fab.classList.replace('scale-100', 'scale-0');
                fab.classList.replace('opacity-100', 'opacity-0');
                fab.classList.add('pointer-events-none');
                renderPage(id);
            }
            document.getElementById('h-title').innerText = title;
        }

        function renderPage(id) {
            const container = document.getElementById(id);
            if(!container || id === 'p2') return;
            
            if(id === 'p5') {
                container.innerHTML = `<div class="pb-4">${members.map(m => createCard(m.n, "person", `chat('${m.p}', 'Halo ${m.n}')`, m.d)).join('')}</div>`;
                return;
            }
            if(!menuData[id]) return;
            container.innerHTML = `<div class="pb-4">${menuData[id].map(item => {
                let act = item.s ? `openMenuSheet('${item.s}')` : (item.ext ? `window.open('${item.url}','_blank')` : `openInSheet('${item.l}','${item.url}')`);
                return createCard(item.l, item.i, act);
            }).join('')}</div>`;
        }

        function createCard(t, i, a, d="") {
            return `
            <button class="card" onclick="${a}">
                <div class="c-icon"><span class="material-symbols-rounded">${i}</span></div>
                <div class="flex-1 text-left">
                    <div class="font-bold text-[16px] leading-tight text-white/90 mb-0.5">${t}</div>
                    ${d ? `<div class="text-[12px] text-[#C1C9BE] font-medium opacity-80">${d}</div>` : ''}
                </div>
                <span class="material-symbols-rounded opacity-20 text-white">chevron_right</span>
            </button>`;
        }

        function openSheet(title) {
            document.getElementById('s-title').innerText = title;
            document.getElementById('app-body').classList.add('sheet-visible');
            sheetIsOpen = true;
            history.pushState({s:1}, "");
        }

        function openInSheet(title, url) {
            const content = document.getElementById('sheet-content');
            const loader = document.getElementById('loading-ui');
            const btnExt = document.getElementById('btn-external');
            const placeholder = document.getElementById('placeholder-btn');
            
            btnExt.onclick = () => window.open(url, '_blank');
            btnExt.classList.remove('hidden');
            placeholder.classList.add('hidden');
            
            content.classList.add('bg-white');
            content.innerHTML = '';
            loader.classList.remove('hidden');
            
            const pUrl = url.includes('spreadsheets') ? url.replace(/\/edit.*$/, '/preview') : url;
            const f = document.createElement('iframe');
            f.className = "w-full h-full border-none opacity-0 transition-opacity duration-300";
            f.src = pUrl;
            f.onload = () => { 
                loader.classList.add('hidden'); 
                f.classList.remove('opacity-0'); 
            };
            content.appendChild(f);
            openSheet(title);
        }

        function openMenuSheet(type) {
            const content = document.getElementById('sheet-content');
            document.getElementById('btn-external').classList.add('hidden');
            document.getElementById('placeholder-btn').classList.remove('hidden');
            document.getElementById('loading-ui').classList.add('hidden');
            content.classList.remove('bg-white');
            
            let html = '<div class="px-5 py-4">';
            let title = type==='prod'?"Area Produksi":(type==='req_tl'?"Request ke TL":"Request ke CSO");
            
            if(type==='prod'){
                html += createCard("Shift Pagi","light_mode","openInSheet('Pagi','https://docs.google.com/spreadsheets/d/17Q2XE0EJeK_lssBFGwsQEhLZ4AodoxeTN6w3G6kIfUA/edit')");
                html += createCard("Shift Malam","dark_mode","openInSheet('Malam','https://docs.google.com/spreadsheets/d/1SDMqGcMUVXzS1xT_TwrnknUEbJTa5sopvqRkI6EIowA/edit')");
            } else {
                const list = type==='req_tl' ? members.filter(m=>m.d.includes("Leader")||m.d.includes("Manager")) : members.filter(m=>!m.d.includes("Leader")&&!m.d.includes("Manager"));
                list.forEach(m => { 
                    const msg = "Halo, tolong bantu pembersihan di area ini.";
                    html += createCard(m.n, "account_circle", `chat('${m.p}','${msg}')`, m.d); 
                });
            }
            content.innerHTML = html + '</div>';
            openSheet(title);
        }

        function closeSheet() {
            document.getElementById('app-body').classList.remove('sheet-visible');
            if(sheetIsOpen) history.back();
            sheetIsOpen = false;
        }

        window.onpopstate = () => { 
            if(sheetIsOpen) { 
                document.getElementById('app-body').classList.remove('sheet-visible'); 
                sheetIsOpen=false; 
            } 
        };

        function chat(p, m) { 
            window.open(`https://wa.me/${p}?text=${encodeURIComponent(m)}`, '_blank'); 
        }

        window.onload = () => renderPage('p1');
    </script>
</body>
</html>

