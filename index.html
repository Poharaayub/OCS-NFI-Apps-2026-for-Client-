<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#F8F9FF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>OCS NFI Apps 26</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    
    <style>
        :root {
            /* M3 Navy Blue Palette */
            --md-sys-color-primary: #003366; 
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #D6E2FF;
            --md-sys-color-on-primary-container: #001B3E;
            
            --md-sys-color-secondary: #535F70; 
            --md-sys-color-secondary-container: #D7E3F7;
            
            --md-sys-color-surface: #F8F9FF; 
            --md-sys-color-surface-container: #EEF0F6;
            --md-sys-color-on-surface: #1A1C1E;
            --md-sys-color-on-surface-variant: #44474E;
            --md-sys-color-outline-variant: #C4C6D0;
            
            --nav-height: 84px;
            --header-height-expanded: 120px;
            --header-height-collapsed: 64px;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            margin: 0; padding: 0; 
            font-family: 'Inter', sans-serif;
        }

        body { 
            background-color: var(--md-sys-color-surface); 
            height: 100dvh; width: 100vw; overflow: hidden;
            color: var(--md-sys-color-on-surface);
            -webkit-font-smoothing: antialiased;
            position: fixed; 
        }

        /* --- Header Styles --- */
        header {
            height: calc(var(--header-height-expanded) + env(safe-area-inset-top));
            padding: calc(env(safe-area-inset-top) + 8px) 24px 20px;
            background: var(--md-sys-color-surface);
            position: fixed; top: 0; left: 0; right: 0; z-index: 40;
            display: flex; flex-direction: column; justify-content: flex-end;
            transition: all 0.4s cubic-bezier(0.2, 0, 0, 1);
        }
        
        header.scrolled {
            height: calc(var(--header-height-collapsed) + env(safe-area-inset-top));
            background: var(--md-sys-color-surface);
            padding-bottom: 12px;
            box-shadow: 0 4px 20px rgba(0, 51, 102, 0.03);
        }
        
        .header-subtitle {
            font-size: 11px; font-weight: 800;
            color: var(--md-sys-color-secondary);
            letter-spacing: 1.5px; text-transform: uppercase;
            margin-bottom: 4px; transition: all 0.3s ease;
        }

        header.scrolled .header-subtitle { opacity: 0; transform: translateY(10px); height: 0; margin: 0; }

        .header-title {
            font-size: 30px; font-weight: 800;
            color: var(--md-sys-color-primary);
            letter-spacing: -0.5px;
            transition: all 0.4s cubic-bezier(0.2, 0, 0, 1);
        }

        header.scrolled .header-title { font-size: 20px; }

        /* --- Layout & Navigation --- */
        .page-container { height: 100dvh; width: 100%; position: relative; }

        .page { 
            display: none; height: 100%; width: 100%; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
            padding: calc(var(--header-height-expanded) + env(safe-area-inset-top) + 12px) 20px calc(var(--nav-height) + env(safe-area-inset-bottom) + 20px);
        }
        
        .page.full-page { 
            padding: 0 !important; 
            height: calc(100dvh - (var(--nav-height) + env(safe-area-inset-bottom)));
            z-index: 10; 
        }
        .page.active { display: block; animation: m3-entry 0.4s cubic-bezier(0.2, 0, 0, 1); }

        @keyframes m3-entry { 
            from { opacity: 0; transform: translateY(12px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: calc(var(--nav-height) + env(safe-area-inset-bottom));
            background: var(--md-sys-color-surface-container); 
            display: flex; justify-content: center; align-items: center; 
            z-index: 50; padding-bottom: env(safe-area-inset-bottom);
        }
        
        .n-btn { 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            height: 100%; flex: 1; color: var(--md-sys-color-on-surface-variant); 
            gap: 4px; transition: all 0.2s;
        }
        
        .icon-pill {
            width: 60px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 100px;
            transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
        }

        .n-btn.active .icon-pill { 
            background: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
        }

        .n-btn .material-symbols-rounded { font-variation-settings: 'FILL' 0, 'wght' 400; font-size: 24px; }
        .n-btn.active .material-symbols-rounded { font-variation-settings: 'FILL' 1, 'wght' 600; }
        
        .n-txt { font-size: 11px; font-weight: 500; letter-spacing: 0.1px; }
        .n-btn.active .n-txt { color: var(--md-sys-color-primary); font-weight: 700; }

        /* --- Cards --- */
        .card-list { display: flex; flex-direction: column; gap: 8px; }
        .card { 
            background: #FFFFFF; padding: 18px 24px; 
            display: flex; align-items: center; width: 100%;
            border-radius: 20px; transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
            border: none;
            box-shadow: 0 1px 2px rgba(0, 51, 102, 0.05);
        }
        .card:active { background: #F2F5FF; transform: scale(0.97); }
        
        .c-icon { 
            width: 44px; height: 44px; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; 
            margin-right: 16px; flex-shrink: 0; 
            background: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-primary);
        }

        .card-text-container { display: flex; flex-direction: column; text-align: left; flex: 1; overflow: hidden; }
        .card-title { font-weight: 700; font-size: 15px; color: var(--md-sys-color-on-surface); line-height: 1.25; }
        .card-desc { font-size: 12px; color: var(--md-sys-color-on-surface-variant); font-weight: 500; margin-top: 2px; opacity: 0.8; }

        .fab { 
            width: 56px; height: 56px; border-radius: 18px; 
            display: flex; align-items: center; justify-content: center; 
            position: fixed; bottom: calc(var(--nav-height) + env(safe-area-inset-bottom) + 24px); 
            right: 20px; z-index: 60; background: var(--md-sys-color-primary); color: white;
            box-shadow: 0 8px 16px rgba(0, 51, 102, 0.2);
            transform: scale(0); opacity: 0; transition: 0.4s cubic-bezier(0.2, 0, 0, 1.2);
        }
        .fab.visible { transform: scale(1); opacity: 1; }

        /* --- M3 Bottom Sheet Responsivitas --- */
        #scrim { 
            position: fixed; inset: 0; background: rgba(0, 10, 30, 0.4); 
            z-index: 1000; visibility: hidden; opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s;
            backdrop-filter: blur(2px);
        }
        
        #sheet { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: #FFFFFF; z-index: 1001; 
            border-radius: 28px 28px 0 0; 
            transform: translateY(105%);
            transition: transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1);
            height: 90dvh;
            height: 90svh; /* Menggunakan svh untuk dukungan mobile yang lebih baik */
            width: 100%;
            max-width: 640px; 
            margin: 0 auto;
            display: flex; flex-direction: column;
            box-shadow: 0 -8px 32px rgba(0, 20, 50, 0.15);
            overflow: hidden;
            will-change: transform;
        }

        /* Responsivitas Desktop: Menyesuaikan radius jika tidak full-width */
        @media (min-width: 641px) {
            #sheet { border-radius: 28px 28px 0 0; }
        }

        .sheet-visible #sheet { transform: translateY(0); }
        .sheet-visible #scrim { visibility: visible; opacity: 1; }
        
        .sheet-handle-container {
            width: 100%; padding: 12px 0 8px; cursor: grab;
            display: flex; justify-content: center; flex-shrink: 0;
            touch-action: none; /* Penting untuk gesture handling manual */
        }
        .sheet-handle { width: 32px; height: 4px; background: #E0E0E0; border-radius: 10px; opacity: 0.8; }

        .sheet-header { 
            padding: 4px 16px 12px;
            display: flex; align-items: center; gap: 8px; flex-shrink: 0; 
            border-bottom: 1px solid #F0F2F5;
            z-index: 10;
        }

        #sheet-content-area {
            flex: 1; position: relative; background: #F8F9FF; overflow: hidden;
            display: flex; flex-direction: column;
        }

        #sheet-content {
            flex: 1; width: 100%; overflow-y: auto; -webkit-overflow-scrolling: touch;
        }

        #sheet-content iframe { width: 100%; height: 100%; border: none; display: block; }

        /* --- M3 Circular Progress --- */
        .m3-circular-container {
            position: absolute; inset: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.9);
            z-index: 50; visibility: hidden; opacity: 0;
            transition: opacity 0.3s;
        }
        .m3-circular-container.active { visibility: visible; opacity: 1; }

        .m3-circular-progress { width: 48px; height: 48px; animation: m3-rotate 2s linear infinite; }
        .m3-circular-progress svg { width: 100%; height: 100%; }
        .m3-circular-progress circle {
            fill: none; stroke: var(--md-sys-color-primary);
            stroke-width: 4; stroke-linecap: round;
            stroke-dasharray: 1, 200; stroke-dashoffset: 0;
            animation: m3-dash 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        @keyframes m3-rotate { 100% { transform: rotate(360deg); } }
        @keyframes m3-dash {
            0% { stroke-dasharray: 1, 200; stroke-dashoffset: 0; }
            50% { stroke-dasharray: 89, 200; stroke-dashoffset: -35px; }
            100% { stroke-dasharray: 89, 200; stroke-dashoffset: -124px; }
        }

        .loading-text { margin-top: 16px; font-size: 11px; font-weight: 700; color: var(--md-sys-color-primary); letter-spacing: 1.5px; text-transform: uppercase; }

        .header-action-btn {
            width: 44px; height: 44px;
            background: var(--md-sys-color-primary-container); 
            color: var(--md-sys-color-on-primary-container);
            border-radius: 14px;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; flex-shrink: 0;
        }
        .header-action-btn:active { transform: scale(0.9); background: #BDD0FF; }

        .m3-field { padding: 0 20px 16px; }
        .m3-input-box {
            background: var(--md-sys-color-surface-container);
            border-radius: 16px; padding: 14px 16px;
            border: 2px solid transparent; transition: all 0.2s;
        }
        .m3-input-box:focus-within { border-color: var(--md-sys-color-primary); background: #FFFFFF; box-shadow: 0 4px 12px rgba(0, 51, 102, 0.05); }
        .m3-label { font-size: 11px; color: var(--md-sys-color-primary); font-weight: 800; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; margin-left: 4px; }
        .m3-input { width: 100%; border: none; background: transparent; font-size: 15px; outline: none; font-weight: 500; color: var(--md-sys-color-on-surface); }
    </style>
</head>
<body id="app-body">

    <header id="main-header">
        <span class="header-subtitle">OCS NFI APPS 26</span>
        <div id="h-title" class="header-title">Request</div>
    </header>

    <!-- FABs -->
    <div id="fab-daily" class="fab" onclick="handleExternalClick('https://drive.google.com/drive/folders/18_DNs4WHDtNw0QvqfZ0Uvx9sAgVVZlz9')">
        <span class="material-symbols-rounded">folder_open</span>
    </div>
    <div id="fab-periodik" class="fab" onclick="handleExternalClick('https://drive.google.com/drive/folders/1Y-sgaereUh9w-HSFwXsGm4GYHN9dLn9Y')">
        <span class="material-symbols-rounded">cloud_sync</span>
    </div>

    <!-- Bottom Sheet -->
    <div id="scrim" onclick="closeSheet()"></div>
    <div id="sheet">
        <div class="sheet-handle-container" id="sheet-handler">
            <div class="sheet-handle"></div>
        </div>
        <div class="sheet-header">
            <button onclick="closeSheet()" class="w-10 h-10 flex items-center justify-center rounded-full active:bg-slate-200 transition-colors">
                <span class="material-symbols-rounded text-slate-600 !text-[24px]">close</span>
            </button>
            <h2 id="s-title" class="text-[17px] font-extrabold flex-1 text-left px-2 text-slate-900 tracking-tight overflow-hidden text-ellipsis whitespace-nowrap">Detail</h2>
            <button id="btn-submit-action" class="header-action-btn hidden">
                <span id="btn-icon" class="material-symbols-rounded !text-[24px]">send</span>
            </button>
        </div>
        
        <div id="sheet-content-area">
            <div id="m3-loader" class="m3-circular-container">
                <div class="m3-circular-progress">
                    <svg viewBox="0 0 50 50">
                        <circle cx="25" cy="25" r="20"></circle>
                    </svg>
                </div>
                <div class="loading-text">Sedang Memuat</div>
            </div>
            <div id="sheet-content"></div>
        </div>
    </div>

    <!-- Main Container -->
    <div id="main-container" class="page-container">
        <div id="p1" class="page full-page">
            <iframe id="iframe-daily" class="w-full h-full border-none" src="https://poharaayub.github.io/Daily-activity-for-client/" loading="lazy"></iframe>
        </div>
        <div id="p2" class="page full-page">
            <iframe id="iframe-periodik" class="w-full h-full border-none" src="about:blank" loading="lazy"></iframe>
        </div>
        <div id="p3" class="page active"></div>
        <div id="p4" class="page"></div>
        <div id="p5" class="page"></div>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="n-btn" onclick="go('p1', 'Harian', this)">
            <div class="icon-pill"><span class="material-symbols-rounded">event_available</span></div>
            <span class="n-txt">Harian</span>
        </div>
        <div class="n-btn" onclick="go('p2', 'Periodik', this)">
            <div class="icon-pill"><span class="material-symbols-rounded">history_edu</span></div>
            <span class="n-txt">Periodik</span>
        </div>
        <div id="default-nav-btn" class="n-btn active" onclick="go('p3', 'Request', this)">
            <div class="icon-pill"><span class="material-symbols-rounded">add_circle</span></div>
            <span class="n-txt">Request</span>
        </div>
        <div class="n-btn" onclick="go('p4', 'Laporan', this)">
            <div class="icon-pill"><span class="material-symbols-rounded">analytics</span></div>
            <span class="n-txt">Laporan</span>
        </div>
        <div class="n-btn" onclick="go('p5', 'Anggota', this)">
            <div class="icon-pill"><span class="material-symbols-rounded">groups</span></div>
            <span class="n-txt">Anggota</span>
        </div>
    </nav>

    <script>
        const members = [
            { n: "Junaidi", d: "OCS Area Manager NFI", p: "6285886607991" },
            { n: "Pohara Ayub", d: "Team Leader", p: "6289637126728" },
            { n: "Sadulloh", d: "Team Leader", p: "6285281587927" },
            { n: "Sulaiman", d: "CSO Head Office Jakarta", p: "6285716230391" },
            { n: "Saiful Bahri", d: "CSO Office Lantai 1", p: "6281389327308" },
            { n: "Siti Maemunah", d: "CSO Office Lantai 2", p: "6285771090915" },
            { n: "Wahidin", d: "Gardener Area Luar", p: "6283819602330" },
            { n: "Edi Ahmad Jubaedi", d: "CSO Produksi", p: "6285883524329" },
            { n: "Ade Surahman", d: "CSO Produksi", p: "6281947172711" },
            { n: "Muhammad Toni", d: "CSO Produksi", p: "6281286448626" },
            { n: "M. Rifai", d: "CSO Produksi", p: "6285810611074" },
            { n: "Amrullah", d: "CSO Warehouse 2 & 1", p: "6283879624040" },
            { n: "Nabrih", d: "WH Tepung Specialist", p: "6281295412005" }
        ];

        const menuData = {
            p3: [
                {l:"Request ke Team Leader", i:"chat_bubble", s:"req_tl"}, 
                {l:"Request ke Cleaner", i:"cleaning_services", s:"req_cso"},
                {l:"Feedback & Komplain", i:"rate_review", s:"feedback_form"}
            ],
            p4: [
                {l:"Daily Activity", i:"inventory_2", url:"https://drive.google.com/drive/folders/1s5BLnmuqGbP3XHq0d30Y1xCUk-tiTejy", ext:true},
                {l:"Periodik Cleaning", i:"cleaning_bucket", url:"https://drive.google.com/drive/folders/1Q7djVthlF5452-4H1NZJVw6Cm3fn7zS8", ext:true},
                {l:"Filter Air Shower", i:"water_full", url:"https://docs.google.com/spreadsheets/d/1qLT8OZwqT_LqWT7u5XLUJT2wVpOWFh7i3S56aAB-dNk/edit?usp=drivesdk", ext:false},
                {l:"Jadwal Shift", i:"calendar_month", url:"https://poharaayub.github.io/Shift-schedule-OCS-NFI-Apps-26/", ext:false},
                {l:"Arsip Big Cleaning", i:"verified", url:"https://drive.google.com/drive/folders/1c1mQZI8IuOqy1HnGMozhmQqVbvW--vpz", ext:true},
                {l:"Laporan Cuci Box", i:"package_2", url:"https://docs.google.com/spreadsheets/d/1vf2pzwlvdsm17cyo1Zrc6DBUL4EeQOng5uJjU12aYvg/edit"},
                {l:"Laporan Cuci Pallet", i:"layers", url:"https://docs.google.com/spreadsheets/d/13dPCq4lEhV4PRA4z2RLQEmPbOIBK9emuclkxk-Dh7iU/edit"},
                {l:"Pallet WH Tepung", i:"warehouse", url:"https://docs.google.com/spreadsheets/d/1C9Zrywvi_ggnHnKHB9fxUU9f-DCWaGNFJflKqbHVEnI/edit", ext:false},
                {l:"Info Aplikasi", i:"info", s:"about_apps"}
            ]
        };

        let sheetIsOpen = false;
        let startY = 0;
        let currentY = 0;
        let isDragging = false;

        function go(id, title, el) {
            document.querySelectorAll('.n-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const current = document.getElementById(id);
            current.classList.add('active');
            
            const header = document.getElementById('main-header');
            const fabDaily = document.getElementById('fab-daily');
            const fabPeriodik = document.getElementById('fab-periodik');
            
            header.style.display = (id === 'p1' || id === 'p2') ? 'none' : 'flex';
            fabDaily.classList.toggle('visible', id === 'p1');
            fabPeriodik.classList.toggle('visible', id === 'p2');
            
            if(id === 'p2' && document.getElementById('iframe-periodik').src === "about:blank") {
                document.getElementById('iframe-periodik').src = "https://poharaayub.github.io/OCS-NFI-Job-Desk-Apps-Client-/";
            }

            renderPage(id);
            document.getElementById('h-title').innerText = (id === 'p1' || id === 'p2') ? '' : title;
            current.scrollTop = 0;
            header.classList.remove('scrolled');
        }

        document.querySelectorAll('.page').forEach(page => {
            page.addEventListener('scroll', (e) => {
                const header = document.getElementById('main-header');
                if (e.target.scrollTop > 10) header.classList.add('scrolled');
                else header.classList.remove('scrolled');
            }, {passive: true});
        });

        function renderPage(id) {
            const container = document.getElementById(id);
            if(!container || id === 'p1' || id === 'p2') return;
            if(container.children.length > 0 && id !== 'p5') return; 
            
            container.innerHTML = '';
            const wrap = document.createElement('div');
            wrap.className = "card-list px-1 py-2";
            
            if(id === 'p5') {
                wrap.innerHTML = members.map(m => createCard(m.n, "person", `chat('${m.p}', 'Halo ${m.n}, mohon bantuan di area...')`, m.d, true)).join('');
            } else if(menuData[id]) {
                wrap.innerHTML = menuData[id].map(item => {
                    let act = item.s ? `openMenuSheet('${item.s}')` : (item.ext ? `handleExternalClick('${item.url}')` : `openInSheet('${item.l}','${item.url}')`);
                    return createCard(item.l, item.i, act, "", false);
                }).join('');
            }
            container.appendChild(wrap);
        }

        function createCard(t, i, a, d="", showDesc=false) {
            return `
            <button class="card" onclick="${a}">
                <div class="c-icon"><span class="material-symbols-rounded">${i}</span></div>
                <div class="card-text-container">
                    <div class="card-title">${t}</div>
                    ${(showDesc && d) ? `<div class="card-desc">${d}</div>` : ''}
                </div>
                <span class="material-symbols-rounded text-slate-300 !text-[18px] ml-2 opacity-50">chevron_right</span>
            </button>`;
        }

        function openSheet(title) {
            const sheet = document.getElementById('sheet');
            sheet.style.transform = 'translateY(0)';
            document.getElementById('s-title').innerText = title;
            document.getElementById('app-body').classList.add('sheet-visible');
            sheetIsOpen = true;
            history.pushState({s:1}, "");
        }

        function openInSheet(title, url) {
            const loader = document.getElementById('m3-loader');
            const container = document.getElementById('sheet-content');
            const submitBtn = document.getElementById('btn-submit-action');
            
            loader.classList.add('active');
            submitBtn.classList.remove('hidden');
            document.getElementById('btn-icon').innerText = "open_in_new";
            submitBtn.onclick = () => handleExternalClick(url);

            container.innerHTML = ''; 
            const pUrl = url.includes('spreadsheets') ? url.replace(/\/edit.*$/, '/preview') : url;
            const f = document.createElement('iframe');
            f.src = pUrl;
            f.style.opacity = '0';
            f.onload = () => { 
                loader.classList.remove('active'); 
                f.style.transition = "opacity 0.4s ease";
                f.style.opacity = '1';
            };
            container.appendChild(f);
            openSheet(title);
        }

        function openMenuSheet(type) {
            const content = document.getElementById('sheet-content');
            const submitBtn = document.getElementById('btn-submit-action');
            content.scrollTop = 0;
            
            let html = '<div class="px-5 pt-2 pb-10">';
            let title = "";

            if (type === 'about_apps') {
                title = "Info Aplikasi";
                submitBtn.classList.add('hidden');
                html += `<div class="flex flex-col items-center py-10 px-6 text-center">
                    <div class="w-20 h-20 bg-blue-50 rounded-[24px] flex items-center justify-center mb-6 border border-blue-100 shadow-sm">
                         <span class="material-symbols-rounded text-[#003366] !text-4xl">shield_person</span>
                    </div>
                    <h3 class="text-xl font-extrabold text-slate-900 tracking-tight">Pohara Ayub</h3>
                    <p class="text-slate-500 font-bold text-[10px] mt-1 uppercase tracking-widest">Sistem Pengembang OCS NFI</p>
                    <div class="mt-8 pt-8 border-t border-slate-100 w-full text-slate-400 text-[10px] font-medium tracking-wide uppercase">
                        Version 26.1.0 (Stable)
                    </div>
                </div>`;
            } else if (type === 'feedback_form') {
                title = "Feedback Klien";
                submitBtn.classList.remove('hidden'); 
                document.getElementById('btn-icon').innerText = "send";
                submitBtn.onclick = submitFeedback;
                html += `
                <div class="pt-2">
                    <div class="m3-field"><label class="m3-label">Lokasi Detail</label><div class="m3-input-box"><input type="text" id="f-name" class="m3-input" placeholder="Misal: Lobby / Toilet LT 1"></div></div>
                    <div class="m3-field"><label class="m3-label">Kategori Komplain</label>
                        <div class="m3-input-box">
                            <select id="f-category" class="m3-input">
                                <option>Kebersihan Area (Debu/Kotor)</option>
                                <option>Lantai Basah / Licin</option>
                                <option>Bau Tidak Sedap</option>
                                <option>Tisu / Sabun Habis</option>
                                <option>Tempat Sampah Penuh</option>
                                <option>Kondisi Taman / Outdoor</option>
                                <option>Respon Petugas Lambat</option>
                                <option>Perilaku / Sikap Petugas</option>
                                <option>Lainnya (Tulis di Pesan)</option>
                            </select>
                        </div>
                    </div>
                    <div class="m3-field"><label class="m3-label">Detail Pesan / Keluhan</label><div class="m3-input-box"><textarea id="f-message" class="m3-input min-h-[120px]" placeholder="Mohon jelaskan kendala yang ditemukan..."></textarea></div></div>
                </div>`;
            } else {
                title = type==='req_tl'?"Team Leader":"Pilih Petugas";
                submitBtn.classList.add('hidden');
                const list = type==='req_tl' ? members.filter(m=>m.d.includes("Leader")||m.d.includes("Manager")) : members.filter(m=>!m.d.includes("Leader")&&!m.d.includes("Manager"));
                html += `<div class="card-list">` + list.map(m => createCard(m.n, "chat", `chat('${m.p}', 'Halo ${m.n}, mohon bantuan di area...')`, m.d, true)).join('') + `</div>`;
            }
            html += '</div>';
            content.innerHTML = html;
            openSheet(title);
        }

        function submitFeedback() {
            const name = document.getElementById('f-name').value;
            const category = document.getElementById('f-category').value;
            const message = document.getElementById('f-message').value;
            if(!name || !message) return;
            
            const loader = document.getElementById('m3-loader');
            loader.classList.add('active');
            
            setTimeout(() => {
                const waText = `*CLIENT FEEDBACK - OCS NFI*%0A%0AðŸ“ *Lokasi:* ${name}%0AðŸ·ï¸ *Kategori:* ${category}%0AðŸ’¬ *Isi:*%0A${message}`;
                window.open(`https://wa.me/6289637126728?text=${waText}`, '_blank');
                loader.classList.remove('active');
                closeSheet();
            }, 1000);
        }

        function closeSheet() { 
            const appBody = document.getElementById('app-body');
            const sheet = document.getElementById('sheet');
            const loader = document.getElementById('m3-loader');
            
            if (appBody.classList.contains('sheet-visible')) {
                appBody.classList.remove('sheet-visible');
                sheet.style.transform = ''; // Reset ke nilai CSS asli (translateY 105%)
                loader.classList.remove('active');
                if(sheetIsOpen) history.back(); 
                sheetIsOpen = false; 
                setTimeout(() => { 
                    if(!sheetIsOpen) document.getElementById('sheet-content').innerHTML = ''; 
                }, 400);
            }
        }

        // Logic Gesture Bottom Sheet yang lebih responsif
        const sheetElement = document.getElementById('sheet');
        const handler = document.getElementById('sheet-handler');

        handler.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
            isDragging = true;
            sheetElement.style.transition = 'none';
        }, {passive: true});

        document.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            const deltaY = e.touches[0].clientY - startY;
            if (deltaY > 0) {
                currentY = deltaY;
                sheetElement.style.transform = `translateY(${currentY}px)`;
            }
        }, {passive: true});

        document.addEventListener('touchend', () => {
            if (!isDragging) return;
            isDragging = false;
            sheetElement.style.transition = 'transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1)';
            
            // Ambang batas tutup sheet (100px)
            if (currentY > 100) {
                closeSheet();
            } else {
                sheetElement.style.transform = 'translateY(0)';
            }
            currentY = 0;
        });

        // Dukungan Mouse Drag untuk Browser Desktop
        handler.addEventListener('mousedown', (e) => {
            startY = e.clientY;
            isDragging = true;
            sheetElement.style.transition = 'none';
            document.body.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const deltaY = e.clientY - startY;
            if (deltaY > 0) {
                currentY = deltaY;
                sheetElement.style.transform = `translateY(${currentY}px)`;
            }
        });

        document.addEventListener('mouseup', () => {
            if (!isDragging) return;
            isDragging = false;
            document.body.style.cursor = '';
            sheetElement.style.transition = 'transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1)';
            if (currentY > 100) closeSheet();
            else sheetElement.style.transform = 'translateY(0)';
            currentY = 0;
        });

        function handleExternalClick(url) { window.open(url, '_blank'); }
        window.onpopstate = () => { if(sheetIsOpen) { closeSheet(); } };
        function chat(p, m) { window.open(`https://wa.me/${p}?text=${encodeURIComponent(m)}`, '_blank'); }

        window.onload = () => { go('p3', 'Request', document.getElementById('default-nav-btn')); };
    </script>
</body>
</html>

